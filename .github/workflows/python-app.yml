# This workflow will install Python dependencies, run tests and lint with a single version of Python
# For more information see: https://help.github.com/actions/language-and-framework-guides/using-python-with-github-actions

name: Build

on:
  push:
    branches: [main]
    paths:
      - "setup.py"
      - "airflow-requirements.txt"
      - "Dockerfile"
      - "Makefile"
      - ".github/workflows/deploy-image.yml"
      - "**.py"
      - "**.ipynb"

concurrency:
  group: "${{ github.ref }}"
  cancel-in-progress: true
jobs:
  format:
    name: Format code
    uses: LineaLabs/lineapy/.github/workflows/format.yml@main
  lint:
    name: Lint
    uses: LineaLabs/lineapy/.github/workflows/lint.yml@main
  typechecks:
    name: Typechecks
    uses: LineaLabs/lineapy/.github/workflows/typecheck.yml@main
  test:
    name: Tests
    needs: [format, lint, typechecks]
    uses: LineaLabs/lineapy/.github/workflows/test.yml@main
  deploy:
    name: Publish
    needs: test
    uses: LineaLabs/lineapy/.github/workflows/deploy-image.yml@main